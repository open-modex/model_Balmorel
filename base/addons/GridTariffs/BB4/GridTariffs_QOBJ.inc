* Additions to the objective function:

* Fixed component and subscribed power (per MW installed)
                 + IOF1000 * SUM(IR, SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),
                         IGR_PRICE_TECH(Y,IR,'GRDSUBS')  * (VGKNACCUMNET(Y,IA,IGETOH) + GKFX(Y,IA,IGETOH)) /(GDATA(IGETOH,'GDFE') *(1$(NOT GEFFRATE(IA,IGETOH))+GEFFRATE(IA,IGETOH)))     ))
* Energy charge winter
                 + SUM(IGR_TIME('GRDECW',IR,IS3,T), SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDECW')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Energy charge summer
                 + SUM(IGR_TIME('GRDECS',IR,IS3,T), SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDECS')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Energy charge TOU step 1
                 + SUM(IGR_TIME('GRDTOU1',IR,IS3,T),  SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU1')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Energy charge TOU step 2
                 + SUM(IGR_TIME('GRDTOU2',IR,IS3,T),  SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU2')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Energy charge TOU step 3
                 + SUM(IGR_TIME('GRDTOU3',IR,IS3,T),  SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU3')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Energy charge TOU step 4
                 + SUM(IGR_TIME('GRDTOU4',IR,IS3,T),  SUM(IAGK_HASORPOT(Y,IA,IGETOH)$RRRAAA(IR,IA),IHOURSINST(IS3,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU4')  * VGF_T(Y,IA,IGETOH,IS3,T)))
* Demand charge winter
                 + IOF1000 * SUM((IR,MMM)$(SUM((IS3,T)$IGR_TIME('GRDDCW',IR,IS3,T), ISSSTTTMMM(IS3,T,MMM))), SUM(IA$RRRAAA(IR,IA), VGETOH_CAP1(Y,IA,MMM)) *  IGR_PRICE_TECH(Y,IR,'GRDDCW'))/(IGR_MONTHSINSIM/card(MMM))    !! Demand charge winter
* Demand charge summer
                 + IOF1000 * SUM((IR,MMM)$(SUM((IS3,T)$IGR_TIME('GRDDCS',IR,IS3,T), ISSSTTTMMM(IS3,T,MMM))), SUM(IA$RRRAAA(IR,IA), VGETOH_CAP1(Y,IA,MMM)) *  IGR_PRICE_TECH(Y,IR,'GRDDCS'))/(IGR_MONTHSINSIM/card(MMM))    !! Demand charge summer
* Demand charge 2 (e.g for spring and fall months)
                 + IOF1000 * SUM((IR,MMM)$(SUM((IS3,T)$IGR_TIME('GRDDC2',IR,IS3,T), ISSSTTTMMM(IS3,T,MMM))), SUM(IA$RRRAAA(IR,IA), VGETOH_CAP1(Y,IA,MMM)) *  IGR_PRICE_TECH(Y,IR,'GRDDC2'))/(IGR_MONTHSINSIM/card(MMM))    !! Demand charge 2
* Demand charge TOU
                 + IOF1000 * SUM((IR,MMM),   SUM(IA$RRRAAA(IR,IA), VGETOH_CAP2(Y,IA,MMM)) *  IGR_PRICE_TECH(Y,IR,'GRDDCTOU'))/(IGR_MONTHSINSIM/card(MMM))
* Demand charge yearly
                 + IOF1000 * SUM(IR,   SUM(IA$RRRAAA(IR,IA), VGETOH_CAPY(Y,IA)) *  IGR_PRICE_TECH(Y,IR,'GRDDCY'))


$ifi not %DemandResponse%==yes  $goto label_GridTariffs_qobj_DR_END
*                 + SUM((IGR_TIME('GRDECW',IR,IS3,T),DEUSER),   SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDECW')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))
*                 + SUM((IGR_TIME('GRDECS',IR,IS3,T),DEUSER),   SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDECS')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))
                 + SUM((IGR_TIME('GRDTOU1',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU1')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))
                 + SUM((IGR_TIME('GRDTOU2',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU2')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))
                 + SUM((IGR_TIME('GRDTOU3',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU3')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))
                 + SUM((IGR_TIME('GRDTOU4',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHIFT)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHIFT,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU4')  * (VDR_UP(Y,IA,DR_TECH_SHIFT,IS3,T) - VDR_DOWN(Y,IA,DR_TECH_SHIFT,IS3,T))))

*                 + SUM((IGR_TIME('GRDECW',IR,IS3,T),DEUSER),   SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDECW')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))
*                 + SUM((IGR_TIME('GRDECS',IR,IS3,T),DEUSER),   SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDECS')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))
                 + SUM((IGR_TIME('GRDTOU1',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU1')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))
                 + SUM((IGR_TIME('GRDTOU2',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU2')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))
                 + SUM((IGR_TIME('GRDTOU3',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU3')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))
                 + SUM((IGR_TIME('GRDTOU4',IR,IS3,T),DEUSER),  SUM(IADR(Y,IA,DR_TECH_SHED)$(RRRAAA(IR,IA) AND DRTECH_USER(DR_TECH_SHED,DEUSER)),IHOURSINST(IS3,T) * IGR_PRICE_USER(Y,IR,DEUSER,'GRDTOU4')  *  VDR_DOWN(Y,IA,DR_TECH_SHED,IS3,T)))

$LABEL label_GridTariffs_qobj_DR_END